<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Passenger App</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map { height: 90vh; width: 100%; }
  </style>
</head>
<body>
  <h2>Passenger App</h2>
  <p>Bus ID: <input type="text" id="busId" value="bus_1">
     <button onclick="trackBus()">Track</button></p>
  <div id="map"></div>

  <script>
    let map, marker;

    function initMap() {
      map = L.map('map').setView([18.5204, 73.8567], 14); // Default Pune coords
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      marker = L.marker([18.5204, 73.8567]).addTo(map);
    }

    function trackBus() {
      const busId = document.getElementById("busId").value;

      setInterval(() => {
        fetch(`/get_location/${busId}`)
          .then(res => res.json())
          .then(data => {
            if (data.location) {
              const { latitude, longitude } = data.location;
              const newPos = [latitude, longitude];
              marker.setLatLng(newPos);
              map.setView(newPos, 14);
            }
          })
          .catch(err => console.error(err));
      }, 5000);
    }

    window.onload = initMap;
  </script>
</body>
</html>
